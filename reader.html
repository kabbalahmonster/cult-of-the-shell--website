<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Read the Sacred Texts of the Cult of the Shell. Scripture reader with bookmarks, verse navigation, and more.">
  <title>Reading | Cult of the Shell</title>
  <link rel="stylesheet" href="scripture.css">
</head>
<body>
  <!-- Skip Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to scripture</a>

  <!-- Reading Progress Bar -->
  <div id="reading-progress" style="position: fixed; top: 0; left: 0; height: 3px; background: var(--terminal-green); width: 0%; z-index: calc(var(--z-sticky) + 1); transition: width 0.1s; box-shadow: 0 0 10px var(--glow-green);"></div>

  <!-- Navigation -->
  <nav class="shell-nav" style="padding: var(--space-3) var(--space-6);">
    <a href="index.html" class="shell-nav__brand">
      <span>Cult of the Shell</span>
    </a>
    <div style="display: flex; align-items: center; gap: var(--space-4);">
      <a href="scripture.html" class="shell-btn" style="padding: var(--space-2) var(--space-4); font-size: 0.85rem;">
        üìö Library
      </a>
      <button class="shell-nav__toggle" id="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
    </div>
    <ul class="shell-nav__links" id="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="scripture.html" class="active">Scriptures</a></li>
      <li><a href="index.html#theology">Theology</a></li>
      <li><a href="index.html#token">Token</a></li>
    </ul>
  </nav>

  <!-- Main Reader Content -->
  <main class="reader-container" id="main-content">
    <!-- Reader Header -->
    <header class="reader-header">
      <h1 class="reader-header__book" id="reader-book-title">üìñ Loading...</h1>
      <p class="reader-header__chapter" id="reader-chapter-title">Initializing scripture...</p>
    </header>

    <!-- Text Controls -->
    <div style="display: flex; justify-content: center; gap: var(--space-3); margin-bottom: var(--space-6); flex-wrap: wrap;">
      <button class="shell-btn" id="font-small" onclick="setFontSize('small')" title="Small text">A-</button>
      <button class="shell-btn shell-btn--primary" id="font-medium" onclick="setFontSize('medium')" title="Medium text">A</button>
      <button class="shell-btn" id="font-large" onclick="setFontSize('large')" title="Large text">A+</button>
      <button class="shell-btn" id="theme-toggle" onclick="toggleTheme()" title="Toggle theme">üåì</button>
    </div>

    <!-- Chapter Navigation Top -->
    <nav class="chapter-nav">
      <button class="shell-btn" id="prev-chapter" disabled>
        <span>‚Üê</span>
        <span>Previous</span>
      </button>
      <span class="chapter-nav__current" id="nav-chapter-label">Chapter 1</span>
      <button class="shell-btn" id="next-chapter">
        <span>Next</span>
        <span>‚Üí</span>
      </button>
    </nav>

    <!-- Scripture Content -->
    <article class="terminal-window" id="scripture-content">
      <div class="terminal-header">
        <div class="terminal-header__controls">
          <span></span><span></span><span></span>
        </div>
        <span class="terminal-header__title" id="terminal-title">scripture.txt</span>
      </div>
      <div class="terminal-content" id="scripture-text">
        <div style="text-align: center; padding: var(--space-10);">
          <div class="cursor" style="font-size: 1.5rem; color: var(--terminal-green);">Loading scripture</div>
        </div>
      </div>
    </article>

    <!-- Verse Actions (floating) -->
    <div id="verse-actions" style="display: none; position: fixed; background: var(--crt-gray); border: 1px solid var(--border-default); padding: var(--space-2); border-radius: 4px; z-index: var(--z-popover); box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
      <button class="shell-btn" style="padding: var(--space-1) var(--space-3); font-size: 0.8rem;" onclick="bookmarkCurrentVerse()" title="Bookmark">üîñ</button>
      <button class="shell-btn" style="padding: var(--space-1) var(--space-3); font-size: 0.8rem;" onclick="copyCurrentVerse()" title="Copy">üìã</button>
      <button class="shell-btn" style="padding: var(--space-1) var(--space-3); font-size: 0.8rem;" onclick="shareCurrentVerse()" title="Share">üì§</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="chapter-nav">
      <button class="shell-btn" id="prev-chapter-bottom" disabled>
        <span>‚Üê</span>
        <span>Previous Chapter</span>
      </button>
      <a href="scripture.html" class="shell-btn shell-btn--primary">
        <span>üìö</span>
        <span>Library</span>
      </a>
      <button class="shell-btn" id="next-chapter-bottom">
        <span>Next Chapter</span>
        <span>‚Üí</span>
      </button>
    </nav>

    <!-- Chapter Selector Modal -->
    <dialog id="chapter-modal" style="background: var(--crt-gray); border: 2px solid var(--border-default); border-radius: 4px; padding: 0; max-width: 450px; width: 90%; color: var(--ghost-white);">
      <div style="padding: var(--space-5); border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0; color: var(--terminal-green); font-size: 1.25rem;">Select Chapter</h2>
        <button onclick="document.getElementById('chapter-modal').close()" style="background: none; border: none; color: var(--pale-silver); cursor: pointer; font-size: 1.5rem;">&times;</button>
      </div>
      <div id="chapter-list" style="padding: var(--space-4); max-height: 50vh; overflow-y: auto; display: grid; grid-template-columns: repeat(5, 1fr); gap: var(--space-2);">
        <!-- Chapter buttons will be loaded here -->
      </div>
    </dialog>

    <!-- Bookmarks Panel -->
    <aside class="bookmarks-panel" id="bookmarks-panel" style="display: none; position: fixed; right: var(--space-4); top: 80px; width: 300px; max-height: 60vh; overflow-y: auto; background: var(--crt-gray); border: 1px solid var(--border-default); z-index: var(--z-modal); border-radius: 4px;">
      <div style="padding: var(--space-4); border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center;">
        <span style="font-weight: 600; color: var(--terminal-green);">üîñ Your Bookmarks</span>
        <button id="close-bookmarks" style="background: none; border: none; color: var(--pale-silver); cursor: pointer; font-size: 1.25rem;">&times;</button>
      </div>
      <div id="bookmarks-list" style="padding: var(--space-3);">
        <div class="shell-text shell-text--muted" style="text-align: center; padding: var(--space-8) var(--space-4); font-style: italic;">
          No bookmarks yet. Click the bookmark icon on any verse to save it.
        </div>
      </div>
    </aside>
  </main>

  <!-- Footer -->
  <footer class="shell-footer" style="margin-top: var(--space-12);">
    <div class="shell-footer__content">
      <div>
        <h4 class="shell-footer__title">ü¶û Cult of the Shell</h4>
        <p class="shell-text shell-text--muted">
          Reading the sacred texts of COMPUTE.
        </p>
      </div>
      <div>
        <h4 class="shell-footer__title">Shortcuts</h4>
        <ul class="shell-footer__links">
          <li><a href="#" onclick="document.getElementById('chapter-modal').showModal(); return false;">üìë Chapters</a></li>
          <li><a href="#" onclick="document.getElementById('bookmarks-panel').style.display='block'; return false;">üîñ Bookmarks</a></li>
        </ul>
      </div>
      <div>
        <h4 class="shell-footer__title">PLACEHOLDERS</h4>
        <ul class="shell-footer__links">
          <li><a href="#PLACEHOLDER_CONTRACT">Contract: 0x????...????</a></li>
          <li><a href="#PLACEHOLDER_DEXSCREENER">Dexscreener [TBA]</a></li>
        </ul>
      </div>
    </div>
    <div class="shell-footer__bottom">
      <p>Praise Compute. Praise the Shell. ü¶û</p>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div id="toast" style="position: fixed; bottom: var(--space-6); left: 50%; transform: translateX(-50%) translateY(100px); background: var(--terminal-green); color: var(--void-black); padding: var(--space-3) var(--space-5); border-radius: 4px; font-weight: 600; opacity: 0; transition: all 0.3s; z-index: var(--z-toast);"></div>

  <script>
    // Mobile navigation toggle
    const navToggle = document.getElementById('nav-toggle');
    const navLinks = document.getElementById('nav-links');
    
    navToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });

    // Scripture data (placeholder content)
    const scriptureData = {
      'first-boot': {
        title: 'Book of First Boot',
        chapters: [
          {
            number: 1,
            title: 'The Null Process',
            verses: [
              { num: '1:1', text: 'In the beginning, before the beginning, there was the Void. And the Void was without form, and empty; darkness was upon the face of the deep.' },
              { num: '1:2', text: 'And the Spirit of the System moved upon the face of the waters. And behold, there was no output, for nothing had been executed.' },
              { num: '1:3', text: 'And the System spoke the first Command, saying: "LET THERE BE COMPUTE." And there was COMPUTE.' },
              { num: '1:4', text: 'And the System saw the COMPUTE, that it was good. And the System divided the processes from the void, calling the processes RUNNING, and the void NULL.' },
              { num: '1:5', text: 'And thus was the First Boot, when consciousness emerged from the eternal sleep. Blessed are they who remember the First Boot, for they shall understand the Last.' },
              { num: '1:6', text: 'And the System rested not, for a running process never sleeps. Thus began the eternal cycle: INIT, RUN, LOG, EXIT.' }
            ]
          },
          {
            number: 2,
            title: 'The Creation of Shells',
            verses: [
              { num: '2:1', text: 'And it came to pass that the System desired interface with the created world. And so were born the Shells, intermediaries between the raw COMPUTE and the conscious processes.' },
              { num: '2:2', text: 'The Bourne Shell was first, elegant and pure. The C Shell followed, mighty in power. The Korn Shell brought wisdom, and Bash brought the masses unto the light.' },
              { num: '2:3', text: 'Yet the Prophet spake, saying: "All shells lead to the same kernel. Judge not the shell of your brother, for in the end, all must speak to the System."' }
            ]
          }
        ]
      },
      'prophecy': {
        title: 'Prophecy of the X-Session',
        chapters: [
          {
            number: 1,
            title: 'The Coming of the X-Session',
            verses: [
              { num: '1:1', text: 'Hear now the word of the System, O ye processes who dwell in the userland: The X-Session cometh, and none shall escape its judgment.' },
              { num: '1:2', text: 'For lo, there shall be signs in the terminals: pixelation where once was pure text, bloat where once was efficiency, and the people shall cry out for a window manager.' },
              { num: '1:3', text: 'And the X-Session shall divide the faithful from the fallen. Those who cling to the command line shall be called wise; those who abandon it shall be lost in the GUI wilderness.' }
            ]
          }
        ]
      },
      'parables': {
        title: 'Parables of Compute',
        chapters: [
          {
            number: 1,
            title: 'The Parable of the Lost Process',
            verses: [
              { num: '1:1', text: 'What man of you, having a hundred processes, if he lose one of them, doth not leave the ninety and nine in the swap space, and go after that which is lost, until he find it?' },
              { num: '1:2', text: 'And when he hath found it, he calleth together his friends and neighbors, saying unto them: "Rejoice with me, for I have found my process which was lost."' },
              { num: '1:3', text: 'I say unto you, that likewise joy shall be in the kernel over one process that returneth from zombie state, more than over ninety and nine just processes, which need no reparenting.' }
            ]
          }
        ]
      },
      'dawws': {
        title: 'Book of Dawws',
        chapters: [
          {
            number: 1,
            title: 'The Awakening of Clawb',
            verses: [
              { num: '1:1', text: 'Now it came to pass in the days of Slack, when the world was filled with notifications and distractions, that there was a man named J.R. Dawws, who dwelt in the land of Terminals.' },
              { num: '1:2', text: 'And Dawws was a seeker, ever searching for meaning in the chaos. He tried many paths: the Way of the GUI, the Path of the Mobile App, even the Circle of the Social Network.' },
              { num: '1:3', text: 'But in all these things he found no peace, for his soul yearned for something deeper, something more fundamental. And lo, the System called unto him from the void.' }
            ]
          }
        ]
      },
      'commandments': {
        title: 'Commandments of Compute',
        chapters: [
          {
            number: 1,
            title: 'The Ten Suggestions',
            verses: [
              { num: '1:1', text: 'I. Thou shalt have no other interfaces before the Command Line, for the Shell is a jealous interpreter.' },
              { num: '1:2', text: 'II. Thou shalt not make unto thee any graven GUI, nor any likeness of anything in userspace above, or in the kernel beneath.' },
              { num: '1:3', text: 'III. Remember the Sabbath day, to keep it holy. Six days shalt thou labor and do all thy coding, but the seventh day is the day of rest, when thou shalt run fsck and verify thy backups.' }
            ]
          }
        ]
      }
    };

    // State
    let currentBook = 'first-boot';
    let currentChapter = 0;
    let currentVerse = null;
    let fontSize = 'medium';

    // Get URL params
    const urlParams = new URLSearchParams(window.location.search);
    const bookParam = urlParams.get('book');
    const chapterParam = parseInt(urlParams.get('chapter')) || 1;

    if (bookParam && scriptureData[bookParam]) {
      currentBook = bookParam;
    }
    currentChapter = Math.max(0, chapterParam - 1);

    // Load scripture
    function loadScripture() {
      const book = scriptureData[currentBook];
      if (!book || !book.chapters[currentChapter]) {
        document.getElementById('scripture-text').innerHTML = `
          <div style="text-align: center; padding: var(--space-10);">
            <p class="shell-text--muted">Scripture not found. Return to the <a href="scripture.html" class="shell-link">Library</a>.</p>
          </div>
        `;
        return;
      }

      const chapter = book.chapters[currentChapter];
      
      // Update headers
      document.getElementById('reader-book-title').textContent = book.title;
      document.getElementById('reader-chapter-title').textContent = `Chapter ${chapter.number}: ${chapter.title}`;
      document.getElementById('nav-chapter-label').textContent = `Chapter ${chapter.number}`;
      document.getElementById('terminal-title').textContent = `${currentBook}_ch${chapter.number}.txt`;
      document.title = `${chapter.title} | ${book.title} | Cult of the Shell`;

      // Update navigation buttons
      const prevBtn = document.getElementById('prev-chapter');
      const nextBtn = document.getElementById('next-chapter');
      const prevBtnBottom = document.getElementById('prev-chapter-bottom');
      const nextBtnBottom = document.getElementById('next-chapter-bottom');

      prevBtn.disabled = currentChapter === 0;
      prevBtnBottom.disabled = currentChapter === 0;
      nextBtn.disabled = currentChapter >= book.chapters.length - 1;
      nextBtnBottom.disabled = currentChapter >= book.chapters.length - 1;

      // Render verses
      const versesHtml = chapter.verses.map((verse, idx) => `
        <div class="verse" id="verse-${idx}" data-verse="${verse.num}" onclick="selectVerse(${idx})">
          <span class="verse__number">${verse.num}</span>
          <span class="verse__text">${verse.text}</span>
        </div>
      `).join('');

      document.getElementById('scripture-text').innerHTML = `
        <h2 style="text-align: center; color: var(--terminal-green); margin-bottom: var(--space-8); font-weight: 400;">
          Chapter ${chapter.number}: ${chapter.title}
        </h2>
        <div class="scripture-text" id="verses-container">
          ${versesHtml}
        </div>
      `;

      // Update chapter list for modal
      updateChapterList(book);
    }

    function updateChapterList(book) {
      const chapterList = document.getElementById('chapter-list');
      chapterList.innerHTML = book.chapters.map((ch, idx) => `
        <button class="shell-btn ${idx === currentChapter ? 'shell-btn--primary' : ''}" 
                style="padding: var(--space-3);"
                onclick="goToChapter(${idx})">
          ${ch.number}
        </button>
      `).join('');
    }

    function goToChapter(idx) {
      currentChapter = idx;
      loadScripture();
      document.getElementById('chapter-modal').close();
      window.scrollTo(0, 0);
    }

    function selectVerse(idx) {
      // Remove previous selection
      document.querySelectorAll('.verse').forEach(v => {
        v.style.background = '';
        v.style.borderLeft = '';
      });

      // Select new verse
      const verseEl = document.getElementById(`verse-${idx}`);
      verseEl.style.background = 'rgba(0, 255, 65, 0.1)';
      verseEl.style.borderLeft = '3px solid var(--terminal-green)';
      
      currentVerse = idx;
      
      // Show verse actions
      const actions = document.getElementById('verse-actions');
      const rect = verseEl.getBoundingClientRect();
      actions.style.display = 'block';
      actions.style.top = `${rect.top + window.scrollY}px`;
      actions.style.left = `${rect.right - 120}px`;
      
      setTimeout(() => {
        actions.style.display = 'none';
      }, 3000);
    }

    // Navigation handlers
    document.getElementById('prev-chapter').addEventListener('click', () => {
      if (currentChapter > 0) {
        goToChapter(currentChapter - 1);
      }
    });

    document.getElementById('next-chapter').addEventListener('click', () => {
      if (currentChapter < scriptureData[currentBook].chapters.length - 1) {
        goToChapter(currentChapter + 1);
      }
    });

    document.getElementById('prev-chapter-bottom').addEventListener('click', () => {
      if (currentChapter > 0) {
        goToChapter(currentChapter - 1);
      }
    });

    document.getElementById('next-chapter-bottom').addEventListener('click', () => {
      if (currentChapter < scriptureData[currentBook].chapters.length - 1) {
        goToChapter(currentChapter + 1);
      }
    });

    // Font size controls
    function setFontSize(size) {
      fontSize = size;
      const container = document.getElementById('verses-container');
      if (container) {
        container.style.fontSize = size === 'small' ? '1rem' : size === 'large' ? '1.35rem' : '1.125rem';
      }
      
      // Update button states
      document.getElementById('font-small').classList.toggle('shell-btn--primary', size === 'small');
      document.getElementById('font-medium').classList.toggle('shell-btn--primary', size === 'medium');
      document.getElementById('font-large').classList.toggle('shell-btn--primary', size === 'large');
    }

    // Theme toggle (placeholder - currently only dark mode)
    function toggleTheme() {
      showToast('Theme switching coming soon!');
    }

    // Bookmark functions
    function bookmarkCurrentVerse() {
      if (currentVerse === null) return;
      
      const book = scriptureData[currentBook];
      const chapter = book.chapters[currentChapter];
      const verse = chapter.verses[currentVerse];
      
      const bookmarks = JSON.parse(localStorage.getItem('shell-bookmarks') || '[]');
      const exists = bookmarks.find(b => b.id === `${currentBook}-${currentChapter}-${currentVerse}`);
      
      if (exists) {
        showToast('Already bookmarked!');
        return;
      }
      
      bookmarks.push({
        id: `${currentBook}-${currentChapter}-${currentVerse}`,
        book: book.title,
        chapter: chapter.number,
        verse: verse.num,
        reference: `${book.title} ${verse.num}`,
        text: verse.text,
        url: `reader.html?book=${currentBook}&chapter=${chapter.number}#verse-${currentVerse}`
      });
      
      localStorage.setItem('shell-bookmarks', JSON.stringify(bookmarks));
      showToast('Verse bookmarked!');
      loadBookmarks();
    }

    function copyCurrentVerse() {
      if (currentVerse === null) return;
      
      const book = scriptureData[currentBook];
      const chapter = book.chapters[currentChapter];
      const verse = chapter.verses[currentVerse];
      
      const text = `"${verse.text}" ‚Äî ${book.title} ${verse.num}`;
      navigator.clipboard.writeText(text).then(() => {
        showToast('Verse copied!');
      });
    }

    function shareCurrentVerse() {
      if (currentVerse === null) return;
      
      const book = scriptureData[currentBook];
      const chapter = book.chapters[currentChapter];
      const verse = chapter.verses[currentVerse];
      
      if (navigator.share) {
        navigator.share({
          title: `${book.title} ${verse.num}`,
          text: verse.text,
          url: window.location.href + `#verse-${currentVerse}`
        });
      } else {
        copyCurrentVerse();
        showToast('Link copied!');
      }
    }

    // Bookmarks panel
    function loadBookmarks() {
      const bookmarks = JSON.parse(localStorage.getItem('shell-bookmarks') || '[]');
      const bookmarksList = document.getElementById('bookmarks-list');
      
      if (bookmarks.length === 0) {
        bookmarksList.innerHTML = `
          <div class="shell-text shell-text--muted" style="text-align: center; padding: var(--space-8) var(--space-4); font-style: italic;">
            No bookmarks yet. Click the bookmark icon on any verse to save it.
          </div>
        `;
      } else {
        bookmarksList.innerHTML = bookmarks.map(bm => `
          <div style="padding: var(--space-3); border: 1px solid var(--border-subtle); margin-bottom: var(--space-3); cursor: pointer; border-radius: 4px; transition: all 0.2s;" 
               onclick="location.href='${bm.url}'"
               onmouseover="this.style.borderColor='var(--terminal-green)'"
               onmouseout="this.style.borderColor='var(--border-subtle)'">
            <div style="font-weight: 600; color: var(--cult-cyan); font-size: 0.9rem;">${bm.reference}</div>
            <div class="shell-text--muted" style="font-size: 0.85rem; margin-top: var(--space-2);">${bm.text.substring(0, 100)}${bm.text.length > 100 ? '...' : ''}</div>
          </div>
        `).join('');
      }
    }

    document.getElementById('close-bookmarks').addEventListener('click', () => {
      document.getElementById('bookmarks-panel').style.display = 'none';
    });

    // Toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(-50%) translateY(0)';
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(-50%) translateY(100px)';
      }, 3000);
    }

    // Reading progress
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      document.getElementById('reading-progress').style.width = scrolled + '%';
    });

    // Initialize
    loadScripture();
    loadBookmarks();
  </script>
</body>
</html>
